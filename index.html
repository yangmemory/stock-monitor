<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æç®€ç›¯ç›˜ - æˆ‘çš„è‡ªé€‰è‚¡</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #121212; color: #e0e0e0; margin: 20px; }
        .container { max-width: 800px; margin: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #1e1e1e; border-radius: 8px; overflow: hidden; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #333; }
        th { background: #2d2d2d; }
        .up { color: #ff4d4f; }    /* çº¢æ¶¨ */
        .down { color: #52c41a; }  /* ç»¿è·Œ */
        .input-group { margin-bottom: 15px; display: flex; gap: 10px; }
        input { padding: 8px; border-radius: 4px; border: 1px solid #444; background: #252525; color: white; }
        button { padding: 8px 16px; border: none; border-radius: 4px; background: #1890ff; color: white; cursor: pointer; }
        button:hover { background: #40a9ff; }
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ“ˆ å®æ—¶ç›¯ç›˜ (5ç§’åˆ·æ–°)</h2>
        <div class="input-group">
            <input type="text" id="stockCode" placeholder="è¾“å…¥ä»£ç ï¼Œå¦‚ sh600519">
            <button onclick="addStock()">æ·»åŠ è‚¡ç¥¨</button>
            <small style="color: #888; align-self: center;">æ ¼å¼: sh600519(æ²ª), sz000001(æ·±)</small>
        </div>
        
        <table id="stockTable">
            <thead>
                <tr>
                    <th>åç§°</th>
                    <th>ç°ä»·</th>
                    <th>æ¶¨è·Œå¹…</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="stockBody">
                </tbody>
        </table>
    </div>

    <script>
        // åˆå§‹åŒ–è‡ªé€‰è‚¡åˆ—è¡¨ (å­˜å…¥ localStorage)
        let stocks = JSON.parse(localStorage.getItem('myStocks')) || ['sh000001', 'sz399001'];

        function addStock() {
            const code = document.getElementById('stockCode').value.trim().toLowerCase();
            if (code && !stocks.includes(code)) {
                stocks.push(code);
                saveAndRefresh();
                document.getElementById('stockCode').value = '';
            }
        }

        function removeStock(index) {
            stocks.splice(index, 1);
            saveAndRefresh();
        }

        function saveAndRefresh() {
            localStorage.setItem('myStocks', JSON.stringify(stocks));
            fetchData();
        }

        async function fetchData() {
            if (stocks.length === 0) {
                document.getElementById('stockBody').innerHTML = '<tr><td colspan="4">æš‚æ— è‡ªé€‰è‚¡</td></tr>';
                return;
            }

            // ä½¿ç”¨æ–°æµªå…è´¹æ¥å£
            const url = `https://hq.sinajs.cn/list=${stocks.join(',')}`;
            
            try {
                const response = await fetch(url);
                const text = await response.text();
                const lines = text.split('\n');
                let html = '';

                lines.forEach((line, index) => {
                    if (!line.includes('"')) return;
                    const data = line.split('"')[1].split(',');
                    const name = data[0]; // åç§°
                    const current = parseFloat(data[3]); // å½“å‰ä»·
                    const yesterday = parseFloat(data[2]); // æ˜¨æ”¶ä»·
                    const change = (((current - yesterday) / yesterday) * 100).toFixed(2);
                    const isUp = change >= 0;

                    html += `
                        <tr>
                            <td>${name} (${stocks[index].toUpperCase()})</td>
                            <td class="${isUp ? 'up' : 'down'}">${current.toFixed(2)}</td>
                            <td class="${isUp ? 'up' : 'down'}">${isUp ? '+' : ''}${change}%</td>
                            <td><button style="background:#ff4d4f" onclick="removeStock(${index})">åˆ é™¤</button></td>
                        </tr>
                    `;
                });
                document.getElementById('stockBody').innerHTML = html;
            } catch (err) {
                console.error("è·å–è¡Œæƒ…å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–è·¨åŸŸè®¾ç½®", err);
            }
        }

        // å®šæ—¶åˆ·æ–°
        setInterval(fetchData, 5000);
        fetchData();
    </script>
</body>
</html>