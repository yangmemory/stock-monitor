<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>海克斯科技 - 智能交易终端</title>
    <style>
        :root {
            --hex-gold: #c8aa6e;
            --hex-blue: #0ac8b9;
            --hex-border: #785a28;
            --bg-dark: #010a13;
            --panel-bg: rgba(9, 20, 40, 0.95);
            --up-red: #ff4e50;
            --down-green: #00ff66;
            --ai-purple: #a066ff;
        }

        body {
            background: radial-gradient(circle at center, #051a27 0%, #010a13 100%);
            color: #f0e6d2;
            font-family: "Microsoft YaHei", "SimHei", sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .terminal-container {
            width: 95%; max-width: 1200px; margin: 30px 0;
            border: 2px solid var(--hex-border); background: var(--panel-bg);
            padding: 25px; box-shadow: 0 0 40px rgba(0, 0, 0, 0.9); position: relative;
        }

        .terminal-container::before {
            content: ""; position: absolute; top: 0; left: 0; right: 0; height: 2px;
            background: linear-gradient(90deg, transparent, var(--hex-gold), transparent);
        }

        .header-main { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px; 
        }
        
        h2 { margin: 0; letter-spacing: 6px; color: var(--hex-gold); text-shadow: 0 0 15px rgba(200, 170, 110, 0.5); text-transform: uppercase; flex: 1; text-align: center; padding-left: 80px; }

        /* 语言切换按钮样式 */
        .lang-switch { display: flex; gap: 5px; }
        .lang-btn { font-size: 10px; padding: 4px 8px; border: 1px solid var(--hex-border); color: var(--hex-gold); background: transparent; cursor: pointer; }
        .lang-btn.active { background: var(--hex-gold); color: #000; }

        .timer-zone {
            display: flex; justify-content: space-around; align-items: center; padding: 15px;
            border: 1px double var(--hex-border); background: rgba(0, 0, 0, 0.5); margin-bottom: 5px; border-radius: 2px;
        }

        #beijingTime { color: var(--hex-blue); font-family: "Courier New", monospace; font-size: 20px; font-weight: bold; }
        #marketCountdown { color: var(--hex-gold); font-size: 14px; letter-spacing: 1px; }

        .ai-info-panel {
            width: 100%; min-height: 75px; background: rgba(160, 102, 255, 0.08);
            border: 1px solid rgba(160, 102, 255, 0.3); margin-bottom: 25px;
            display: flex; align-items: center; overflow: hidden; position: relative;
        }

        .ai-info-panel::before {
            content: attr(data-label); background: var(--ai-purple); color: white;
            font-size: 11px; font-weight: bold; padding: 0 15px; height: 100%;
            display: flex; align-items: center; z-index: 2; width: 140px; text-align: center;
        }

        #aiStrategyBox { flex: 1; padding: 10px 20px; font-size: 13px; color: #f0e6d2; display: flex; flex-direction: column; gap: 6px; }
        .ai-val { color: var(--hex-blue); font-weight: bold; padding: 0 4px; }
        .ai-label { color: rgba(240, 230, 210, 0.6); font-size: 11px; margin-right: 5px; }

        .lol-btn { background: linear-gradient(to bottom, #1e2328 0%, #111111 100%); border: 1px solid var(--hex-gold); color: var(--hex-gold); cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.2s; display: inline-flex; align-items: center; justify-content: center; }
        .lol-btn:hover { background: var(--hex-gold); color: #010a13; box-shadow: 0 0 15px var(--hex-gold); }
        .action-btn-large { padding: 6px 16px; font-size: 11px; min-width: 80px; margin-left: 8px; }
        .btn-edit { border-color: var(--hex-blue); color: var(--hex-blue); }
        .btn-remove { border-color: var(--up-red); color: var(--up-red); }

        .controls { display: flex; justify-content: space-between; align-items: center; background: rgba(200, 170, 110, 0.03); padding: 20px; margin-bottom: 25px; border: 1px solid rgba(120, 90, 40, 0.2); gap: 20px; flex-wrap: wrap; }
        input { background: #1e2328; border: 1px solid var(--hex-border); color: #f0e6d2; padding: 10px 15px; outline: none; font-size: 13px; flex: 1; min-width: 80px; }

        table { width: 100%; border-collapse: collapse; }
        th { border-bottom: 2px solid var(--hex-border); padding: 15px 12px; color: var(--hex-blue); text-align: left; font-size: 13px; }
        td { padding: 18px 12px; border-bottom: 1px solid rgba(120, 90, 40, 0.1); }
        tr.stock-row:hover { background: rgba(10, 200, 185, 0.05); cursor: pointer; }

        .ai-tag { padding: 8px 12px; border-radius: 1px; font-size: 11px; font-weight: bold; display: inline-block; min-width: 155px; text-align: center; }
        .ai-buy { background: var(--up-red); color: white; }
        .ai-sell { background: var(--down-green); color: black; }
        .ai-hold { border: 1px solid var(--ai-purple); color: var(--ai-purple); }

        .chart-nav { display: flex; gap: 8px; margin-bottom: 15px; }
        .nav-btn { padding: 6px 14px; font-size: 11px; min-width: 70px; }
        .nav-btn.active { background: var(--hex-blue); color: #010a13; border-color: var(--hex-blue); }

        @keyframes alert-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); box-shadow: 0 0 15px currentColor; } }
        .flash-alert { animation: alert-pulse 1s infinite; }
        .up { color: var(--up-red); font-weight: bold; }
        .down { color: var(--down-green); font-weight: bold; }

        .market-view { display: none; margin-bottom: 25px; border: 1px solid var(--hex-blue); background: #000; padding: 15px; }
        .market-grid { display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .order-book { font-family: "Courier New", monospace; font-size: 13px; border-left: 1px solid #333; padding-left: 15px; }
        .order-row { display: flex; justify-content: space-between; margin: 5px 0; }
    </style>
</head>
<body>

<div class="terminal-container">
    <div class="header-main">
        <h2 id="ui-title">海克斯科技 - 智能交易终端</h2>
        <div class="lang-switch">
            <button class="lang-btn active" onclick="setLanguage('zh-CN')">简</button>
            <button class="lang-btn" onclick="setLanguage('zh-HK')">繁</button>
        </div>
    </div>

    <div class="timer-zone">
        <div id="beijingTime">同步中...</div>
        <div id="marketCountdown" id="ui-market-scan">正在扫描全局市场环境...</div>
    </div>

    <div class="ai-info-panel" id="ai-panel" data-label="核心战略分析">
        <div id="aiStrategyBox">请选择资产，载入海克斯深度战略分析...</div>
    </div>
    
    <div class="controls">
        <div class="main-inputs">
            <input type="text" id="stockCode" placeholder="代码 (如 sh600519)">
            <input type="number" id="buyPrice" placeholder="持仓成本">
            <input type="number" id="buyQty" placeholder="持股数量">
            <button class="lol-btn" style="padding: 10px 30px; min-width: 120px;" onclick="addStock()" id="submitBtn">注入资产</button>
        </div>
        <div class="data-management">
            <button class="lol-btn" style="padding: 10px 15px; color: var(--hex-blue);" onclick="exportData()" id="ui-export">导出存档</button>
            <button class="lol-btn" style="padding: 10px 15px;" onclick="document.getElementById('importFile').click()" id="ui-import">导入存档</button>
            <input type="file" id="importFile" hidden onchange="importData(event)">
        </div>
    </div>

    <div id="chartArea" class="market-view">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <div class="chart-nav" id="chartNav">
                <button class="lol-btn nav-btn active" data-type="min" onclick="changeChart('min', this)">分时</button>
                <button class="lol-btn nav-btn" data-type="five" onclick="changeChart('five', this)">五日</button>
                <button class="lol-btn nav-btn" data-type="daily" onclick="changeChart('daily', this)">日K</button>
                <button class="lol-btn nav-btn" data-type="weekly" onclick="changeChart('weekly', this)">周K</button>
                <button class="lol-btn nav-btn" data-type="monthly" onclick="changeChart('monthly', this)">月K</button>
            </div>
            <button class="lol-btn btn-remove" style="padding: 6px 15px; font-size: 11px;" onclick="closeChart()" id="ui-close-monitor">关闭监控</button>
        </div>
        <div class="market-grid">
            <div style="text-align: center;"><img id="chartImg" src="" style="max-width: 100%; border: 1px solid #222;"></div>
            <div class="order-book" id="orderBookBody">
                <div style="color:var(--hex-blue); border-bottom:1px solid #333; padding-bottom:8px; margin-bottom:10px; font-weight: bold;" id="ui-orderbook-title">实时盘口 (五档)</div>
                <div id="sellList"></div>
                <div style="height:1px; background:#333; margin:10px 0;"></div>
                <div id="buyList"></div>
            </div>
        </div>
    </div>

    <table>
        <thead>
            <tr id="table-head">
                <th>资产标的</th>
                <th>最新价格</th>
                <th>持仓 / 成本</th>
                <th>盈亏金额</th>
                <th>AI 动作建议</th>
                <th style="text-align: right; padding-right: 30px;">管理终端</th>
            </tr>
        </thead>
        <tbody id="stockBody"></tbody>
    </table>
</div>

<script>
    let stockData = JSON.parse(localStorage.getItem('myHexStocks')) || [];
    let currentChartCode = "";
    let currentChartType = "min";
    let currentLang = 'zh-CN';

    const i18n = {
        'zh-CN': {
            title: "海克斯科技 - 智能交易终端",
            scan: "正在扫描全局市场环境...",
            panelLabel: "核心战略分析",
            panelDefault: "请选择资产，载入海克斯深度战略分析...",
            inputCode: "代码 (如 sh600519)",
            inputCost: "持仓成本",
            inputQty: "持股数量",
            btnSubmit: "注入资产",
            btnConfirm: "确认修改",
            btnExport: "导出存档",
            btnImport: "导入存档",
            btnClose: "关闭监控",
            orderTitle: "实时盘口 (五档)",
            thTarget: "资产标的",
            thPrice: "最新价格",
            thCost: "持仓 / 成本",
            thPnl: "盈亏金额",
            thAction: "AI 动作建议",
            thManage: "管理终端",
            trendUp: "多头向上",
            trendDown: "空头承压",
            buyPoint: "建议买入位",
            sellPoint: "建议卖出位",
            rangePos: "区间位置",
            sellRef: "止盈参考",
            buyRef: "补仓参考",
            hold: "持币观望",
            edit: "修改",
            remove: "移除",
            confirmRemove: "确定移除该资产监控？",
            buySug: "建议买入",
            sellSug: "建议卖出"
        },
        'zh-HK': {
            title: "海克斯科技 - 智能交易終端",
            scan: "正在掃描全局市場環境...",
            panelLabel: "核心戰略分析",
            panelDefault: "請選擇資產，載入海克斯深度戰略分析...",
            inputCode: "代碼 (如 sh600519)",
            inputCost: "持倉成本",
            inputQty: "持股數量",
            btnSubmit: "注入資產",
            btnConfirm: "確認修改",
            btnExport: "導出存檔",
            btnImport: "導入存檔",
            btnClose: "關閉監控",
            orderTitle: "實時盤口 (五檔)",
            thTarget: "資產標的",
            thPrice: "最新價格",
            thCost: "持倉 / 成本",
            thPnl: "盈虧金額",
            thAction: "AI 動作建議",
            thManage: "管理終端",
            trendUp: "多頭向上",
            trendDown: "空頭承壓",
            buyPoint: "建議買入位",
            sellPoint: "建議賣出位",
            rangePos: "空間定位",
            sellRef: "止盈參考",
            buyRef: "補倉參考",
            hold: "持幣觀望",
            edit: "修改",
            remove: "移除",
            confirmRemove: "確定移除該資產監控？",
            buySug: "建議買入",
            sellSug: "建議賣出"
        }
    };

    function setLanguage(lang) {
        currentLang = lang;
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        updateUI();
        fetchData();
    }

    function updateUI() {
        const t = i18n[currentLang];
        document.getElementById('ui-title').innerText = t.title;
        document.getElementById('ai-panel').setAttribute('data-label', t.panelLabel);
        document.getElementById('stockCode').placeholder = t.inputCode;
        document.getElementById('buyPrice').placeholder = t.inputCost;
        document.getElementById('buyQty').placeholder = t.inputQty;
        document.getElementById('submitBtn').innerText = (document.getElementById('submitBtn').innerText === i18n['zh-CN'].btnConfirm || document.getElementById('submitBtn').innerText === i18n['zh-HK'].btnConfirm) ? t.btnConfirm : t.btnSubmit;
        document.getElementById('ui-export').innerText = t.btnExport;
        document.getElementById('ui-import').innerText = t.btnImport;
        document.getElementById('ui-close-monitor').innerText = t.btnClose;
        document.getElementById('ui-orderbook-title').innerText = t.orderTitle;
        
        const ths = document.getElementById('table-head').cells;
        ths[0].innerText = t.thTarget; ths[1].innerText = t.thPrice; ths[2].innerText = t.thCost;
        ths[3].innerText = t.thPnl; ths[4].innerText = t.thAction; ths[5].innerText = t.thManage;

        const navs = document.querySelectorAll('.nav-btn');
        const navMap = currentLang === 'zh-CN' ? ['分时','五日','日K','周K','月K'] : ['分時','五日','日K','周K','月K'];
        navs.forEach((n, i) => n.innerText = navMap[i]);
    }

    function updateMarketClock() {
        const now = new Date();
        document.getElementById('beijingTime').innerText = (currentLang === 'zh-CN' ? "北京时间: " : "北京時間: ") + now.toLocaleTimeString('zh-CN', { hour12: false });
        // ... (倒计时逻辑逻辑简化)
    }

    function updateAIInfoBox(code) {
        const box = document.getElementById('aiStrategyBox');
        const t = i18n[currentLang];
        if (!code) { box.innerHTML = `<div>${t.panelDefault}</div>`; return; }
        const d = window["v_" + code].split('~');
        const name = d[1], current = parseFloat(d[3]), open = parseFloat(d[5]), low = parseFloat(d[34]), high = parseFloat(d[33]);
        let trend = current > open ? t.trendUp : t.trendDown;
        let buyPoint = (low + (high - low) * 0.382).toFixed(2);
        let sellPoint = (current * 1.05).toFixed(2);
        let rangePos = ((current - low) / (high - low) * 100).toFixed(1);

        box.innerHTML = `
            <div style="display:flex; justify-content:space-between; width:100%;">
                <span>${currentLang==='zh-CN'?'追踪':'追蹤'}: <b class="ai-val">${name}</b> | ${currentLang==='zh-CN'?'趋势':'趨勢'}: <b style="color:${current>open?'var(--up-red)':'var(--down-green)'}">${trend}</b></span>
                <span>${currentLang==='zh-CN'?'今日高点':'今日高點'}: <b class="ai-val">${high.toFixed(2)}</b> | ${currentLang==='zh-CN'?'今日低点':'今日低點'}: <b class="ai-val">${low.toFixed(2)}</b></span>
            </div>
            <div style="margin-top:5px; display:flex; gap:25px;">
                <span><span class="ai-label">${t.buyPoint}:</span><b style="color:var(--down-green)">${buyPoint}</b></span>
                <span><span class="ai-label">${t.sellPoint}:</span><b style="color:var(--up-red)">${sellPoint}</b></span>
                <span><span class="ai-label">${t.rangePos}:</span><b>${rangePos}%</b></span>
            </div>`;
    }

    function fetchData() {
        const t = i18n[currentLang];
        if (stockData.length === 0) { document.getElementById('stockBody').innerHTML = `<tr><td colspan="6" style="text-align:center;color:#444;padding:40px">${currentLang==='zh-CN'?'等待注入数据...':'等待注入數據...'}</td></tr>`; return; }
        const codes = stockData.map(s => s.code);
        const script = document.createElement('script');
        script.src = `https://qt.gtimg.cn/q=${codes.join(',')}`;
        document.body.appendChild(script);
        script.onload = function() {
            let html = '';
            stockData.forEach((item, index) => {
                const varName = "v_" + item.code;
                if (window[varName]) {
                    const d = window[varName].split('~');
                    const price = parseFloat(d[3]), change = d[32];
                    let pnl = '--';
                    if (item.cost > 0 && item.qty > 0) {
                        const amt = (price - item.cost) * item.qty;
                        pnl = `<span class="${amt >= 0 ? 'up' : 'down'}">${amt >= 0 ? '+' : ''}${amt.toFixed(2)}</span>`;
                    }
                    html += `<tr class="stock-row" onclick="showChart('${item.code}')">
                        <td><span style="color:var(--hex-gold)">✦</span> ${d[1]}<br><small style="color:#555">${item.code.toUpperCase()}</small></td>
                        <td class="${parseFloat(change)>=0 ? 'up' : 'down'} font-bold">${price.toFixed(2)}</td>
                        <td style="font-size:12px">${item.qty} / <span style="color:var(--hex-gold)">${item.cost}</span></td>
                        <td>${pnl}</td>
                        <td>${getAIDynamicAction(d, item)}</td>
                        <td style="text-align: right; padding-right: 20px;">
                            <button class="lol-btn action-btn-large btn-edit" onclick="editStock(event, ${index})">${t.edit}</button>
                            <button class="lol-btn action-btn-large btn-remove" onclick="removeStock(event, ${index})">${t.remove}</button>
                        </td>
                    </tr>`;
                }
            });
            document.getElementById('stockBody').innerHTML = html;
            if(currentChartCode) { updateOrderBook(currentChartCode); updateAIInfoBox(currentChartCode); }
        };
    }

    function getAIDynamicAction(d, item) {
        const t = i18n[currentLang];
        const current = parseFloat(d[3]), cost = parseFloat(item.cost), change = parseFloat(d[32]), low = parseFloat(d[34]);
        const aiBuyPoint = (low + (parseFloat(d[33]) - low) * 0.382).toFixed(2);
        let label = "", cssClass = "ai-hold", isAlert = false;
        if (cost > 0) {
            const pRate = (current - cost) / cost;
            if (pRate > 0.05) { label = `${t.sellRef}: ${(current*0.995).toFixed(2)}`; cssClass = "ai-sell"; isAlert = true; }
            else if (pRate < -0.05 && current > low) { label = `${t.buyRef}: ${(current*1.005).toFixed(2)}`; cssClass = "ai-buy"; isAlert = true; }
        }
        if (!label) {
            if (change >= 2.0) { label = `${t.buySug}: ${aiBuyPoint}`; cssClass = "ai-buy"; }
            else if (change <= -2.0) { label = `${t.sellSug}: ${(current*0.985).toFixed(2)}`; cssClass = "ai-sell"; }
            else { label = t.hold; cssClass = "ai-hold"; }
        }
        return `<span class="ai-tag ${cssClass} ${isAlert ? 'flash-alert' : ''}">${label}</span>`;
    }

    function addStock() {
        const c = document.getElementById('stockCode').value.trim().toLowerCase(), cost = parseFloat(document.getElementById('buyPrice').value) || 0, qty = parseFloat(document.getElementById('buyQty').value) || 0;
        if (!c) return;
        const i = stockData.findIndex(s => s.code === c);
        if (i > -1) stockData[i] = { code: c, cost, qty }; else stockData.push({ code: c, cost, qty });
        saveAndRefresh();
    }
    function editStock(e, i) { e.stopPropagation(); const item = stockData[i]; document.getElementById('stockCode').value = item.code; document.getElementById('buyPrice').value = item.cost; document.getElementById('buyQty').value = item.qty; document.getElementById('submitBtn').innerText = i18n[currentLang].btnConfirm; window.scrollTo({ top: 0, behavior: 'smooth' }); }
    function removeStock(e, i) { e.stopPropagation(); if(confirm(i18n[currentLang].confirmRemove)) { stockData.splice(i, 1); saveAndRefresh(); } }
    function saveAndRefresh() { localStorage.setItem('myHexStocks', JSON.stringify(stockData)); document.getElementById('submitBtn').innerText = i18n[currentLang].btnSubmit; fetchData(); }
    function showChart(code) { currentChartCode = code; document.getElementById('chartArea').style.display = 'block'; changeChart(currentChartType, document.querySelector('.nav-btn.active')); }
    function changeChart(type, btn) {
        currentChartType = type;
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
        const typeMap = { 'min': 'min/n/', 'five': 'min/n/', 'daily': 'daily/n/', 'weekly': 'weekly/n/', 'monthly': 'monthly/n/' };
        document.getElementById('chartImg').src = `https://image.sinajs.cn/newchart/${typeMap[type]}${currentChartCode}.gif?t=${Date.now()}`;
        updateAIInfoBox(currentChartCode);
    }
    function closeChart() { currentChartCode = ""; document.getElementById('chartArea').style.display = 'none'; updateAIInfoBox(null); }
    function updateOrderBook(code) {
        const d = window["v_" + code].split('~');
        let sH = ''; for(let i=5; i>=1; i--) sH += `<div class="order-row"><span>${currentLang==='zh-CN'?'卖':'賣'}${i}</span><span class="${parseFloat(d[19+(i-1)*2])>=d[4]?'up':'down'}">${parseFloat(d[19+(i-1)*2]).toFixed(2)}</span><span style="color:var(--hex-gold)">${Math.floor(d[20+(i-1)*2]/100)}</span></div>`;
        document.getElementById('sellList').innerHTML = sH;
        let bH = ''; for(let i=1; i<=5; i++) bH += `<div class="order-row"><span>${currentLang==='zh-CN'?'买':'買'}${i}</span><span class="${parseFloat(d[9+(i-1)*2])>=d[4]?'up':'down'}">${parseFloat(d[9+(i-1)*2]).toFixed(2)}</span><span style="color:var(--hex-gold)">${Math.floor(d[10+(i-1)*2]/100)}</span></div>`;
        document.getElementById('buyList').innerHTML = bH;
    }
    function exportData() { const blob = new Blob([JSON.stringify(stockData)], {type:"application/json"}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download='海克斯存档.json'; a.click(); }
    function importData(e) { const r = new FileReader(); r.onload = (f) => { try { stockData = JSON.parse(f.target.result); saveAndRefresh(); } catch(e) {} }; r.readAsText(e.target.files[0]); }

    setInterval(updateMarketClock, 1000);
    setInterval(fetchData, 3000);
    window.onload = () => { updateUI(); updateMarketClock(); fetchData(); };
</script>

</body>
</html>
