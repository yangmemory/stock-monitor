<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>海克斯科技 - 智能交易终端</title>
    <style>
        :root {
            --hex-gold: #c8aa6e;
            --hex-blue: #0ac8b9;
            --hex-border: #785a28;
            --bg-dark: #010a13;
            --panel-bg: rgba(9, 20, 40, 0.95);
            --up-red: #ff4e50;
            --down-green: #00ff66;
            --ai-purple: #a066ff;
        }

        body {
            background: radial-gradient(circle at center, #051a27 0%, #010a13 100%);
            color: #f0e6d2;
            font-family: "Microsoft YaHei", sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .terminal-container {
            width: 95%;
            max-width: 1200px;
            margin: 30px 0;
            border: 2px solid var(--hex-border);
            background: var(--panel-bg);
            padding: 25px;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.9);
            position: relative;
        }

        .terminal-container::before {
            content: "";
            position: absolute; top: 0; left: 0; right: 0; height: 2px;
            background: linear-gradient(90deg, transparent, var(--hex-gold), transparent);
        }

        .header-main { text-align: center; margin-bottom: 20px; }
        h2 { margin: 0; letter-spacing: 6px; color: var(--hex-gold); text-shadow: 0 0 15px rgba(200, 170, 110, 0.5); text-transform: uppercase; }
        
        .timer-zone {
            display: flex; justify-content: space-around; align-items: center; padding: 15px;
            border: 1px double var(--hex-border); background: rgba(0, 0, 0, 0.5); margin-bottom: 5px; border-radius: 2px;
        }

        #beijingTime { color: var(--hex-blue); font-family: "Courier New", monospace; font-size: 20px; font-weight: bold; }
        #marketCountdown { color: var(--hex-gold); font-size: 14px; letter-spacing: 1px; }

        .ai-scrolling-info {
            width: 100%; height: 32px; background: rgba(160, 102, 255, 0.1);
            border: 1px solid rgba(160, 102, 255, 0.3); margin-bottom: 25px;
            overflow: hidden; display: flex; align-items: center;
        }

        .ai-scrolling-info::before {
            content: "AI STRATEGY"; background: var(--ai-purple); color: white;
            font-size: 10px; font-weight: bold; padding: 0 12px; height: 100%;
            display: flex; align-items: center; z-index: 2;
        }

        .marquee-container { flex: 1; white-space: nowrap; overflow: hidden; position: relative; }
        .marquee-content {
            display: inline-block; padding-left: 100%; animation: marquee 35s linear infinite;
            color: var(--hex-blue); font-size: 13px;
        }

        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* LOL 风格大按钮通用样式 */
        .lol-btn {
            background: linear-gradient(to bottom, #1e2328 0%, #111111 100%);
            border: 1px solid var(--hex-gold);
            color: var(--hex-gold);
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: inset 0 0 5px rgba(0,0,0,1);
        }

        .lol-btn:hover {
            background: var(--hex-gold);
            color: #010a13;
            box-shadow: 0 0 15px var(--hex-gold);
        }

        .lol-btn:active {
            transform: scale(0.95);
        }

        /* 列表专用大按钮 */
        .action-btn-large {
            padding: 6px 16px;
            font-size: 11px;
            min-width: 80px;
            margin-left: 8px;
            letter-spacing: 1px;
        }

        .btn-edit { border-color: var(--hex-blue); color: var(--hex-blue); }
        .btn-edit:hover { background: var(--hex-blue); color: #010a13; box-shadow: 0 0 15px var(--hex-blue); }

        .btn-remove { border-color: var(--up-red); color: var(--up-red); }
        .btn-remove:hover { background: var(--up-red); color: #fff; box-shadow: 0 0 15px var(--up-red); }

        .controls {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(200, 170, 110, 0.03); padding: 18px; margin-bottom: 25px;
            border: 1px solid rgba(120, 90, 40, 0.2); gap: 10px; flex-wrap: wrap;
        }

        .input-group { display: flex; gap: 8px; }
        input { background: #1e2328; border: 1px solid var(--hex-border); color: #f0e6d2; padding: 10px; outline: none; font-size: 13px; }
        
        table { width: 100%; border-collapse: collapse; }
        th { border-bottom: 2px solid var(--hex-border); padding: 15px 12px; color: var(--hex-blue); text-align: left; font-size: 13px; text-transform: uppercase; }
        td { padding: 18px 12px; border-bottom: 1px solid rgba(120, 90, 40, 0.1); }
        tr.stock-row:hover { background: rgba(10, 200, 185, 0.05); cursor: pointer; }

        .ai-tag { padding: 8px 12px; border-radius: 1px; font-size: 11px; font-weight: bold; display: inline-block; min-width: 150px; text-align: center; }
        .ai-buy { background: var(--up-red); color: white; }
        .ai-sell { background: var(--down-green); color: black; }
        .ai-hold { border: 1px solid var(--ai-purple); color: var(--ai-purple); }

        .up { color: var(--up-red); font-weight: bold; }
        .down { color: var(--down-green); font-weight: bold; }

        .market-view { display: none; margin-bottom: 25px; border: 1px solid var(--hex-blue); background: #000; padding: 15px; }
        .market-grid { display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        .order-book { font-family: "Courier New", monospace; font-size: 13px; border-left: 1px solid #333; padding-left: 15px; }
        .order-row { display: flex; justify-content: space-between; margin: 5px 0; }

        .status-bar { margin-top: 30px; font-size: 11px; color: #444; text-align: center; letter-spacing: 2px; }
    </style>
</head>
<body>

<div class="terminal-container">
    <div class="header-main">
        <h2>海克斯科技 - 智能交易终端</h2>
    </div>

    <div class="timer-zone">
        <div id="beijingTime">同步中...</div>
        <div id="marketCountdown">正在扫描全局市场环境...</div>
    </div>

    <div class="ai-scrolling-info">
        <div class="marquee-container">
            <div class="marquee-content" id="aiMarqueeText">正在连接海克斯中央处理器... 注入资产以开启实时战略监控。</div>
        </div>
    </div>
    
    <div class="controls">
        <div class="input-group">
            <input type="text" id="stockCode" placeholder="资产代码 (sh600519)">
            <input type="number" id="buyPrice" style="width:100px" placeholder="持仓成本">
            <input type="number" id="buyQty" style="width:100px" placeholder="持股数量">
            <button class="lol-btn" style="padding: 10px 25px;" onclick="addStock()" id="submitBtn">注入资产</button>
        </div>
        <div class="input-group">
            <button class="lol-btn" style="padding: 10px 15px; color: var(--hex-blue); border-color: var(--hex-blue);" onclick="exportData()">导出数据</button>
            <button class="lol-btn" style="padding: 10px 15px;" onclick="document.getElementById('importFile').click()">导入数据</button>
            <input type="file" id="importFile" hidden onchange="importData(event)">
        </div>
    </div>

    <div id="chartArea" class="market-view">
        <div style="margin-bottom:15px; display: flex; justify-content: space-between; align-items: center;">
            <div>
                <button class="lol-btn" style="padding: 5px 15px; font-size: 11px;" onclick="changeChart('min')">实时分时</button>
                <button class="lol-btn" style="padding: 5px 15px; font-size: 11px; margin-left: 10px;" onclick="changeChart('daily')">日K线图</button>
            </div>
            <button class="lol-btn btn-remove" style="padding: 5px 15px; font-size: 11px;" onclick="closeChart()">收起监控</button>
        </div>
        <div class="market-grid">
            <div style="text-align: center;">
                <img id="chartImg" src="" style="max-width: 100%; border: 1px solid #222;">
            </div>
            <div class="order-book" id="orderBookBody">
                <div style="color:var(--hex-blue); border-bottom:1px solid #333; padding-bottom:8px; margin-bottom:10px; font-weight: bold; letter-spacing: 1px;">实时盘口 (五档)</div>
                <div id="sellList"></div>
                <div style="height:1px; background:#333; margin:10px 0;"></div>
                <div id="buyList"></div>
            </div>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>资产标的</th>
                <th>最新价格</th>
                <th>持仓 / 成本</th>
                <th>盈亏金额</th>
                <th>AI 动作建议</th>
                <th style="text-align: right; padding-right: 30px;">管理终端</th>
            </tr>
        </thead>
        <tbody id="stockBody"></tbody>
    </table>

    <div class="status-bar" id="updateTime">HEXTECH CORE V3.6 - LOL 交互界面适配完成</div>
</div>

<script>
    let stockData = JSON.parse(localStorage.getItem('myHexStocks')) || [];
    let currentChartCode = "";

    function updateMarketClock() {
        const now = new Date();
        document.getElementById('beijingTime').innerText = "北京时间: " + now.toLocaleTimeString('zh-CN', { hour12: false });
        const hour = now.getHours(); const min = now.getMinutes(); const totalMin = hour * 60 + min; const day = now.getDay();
        let statusText = "";
        if (day === 0 || day === 6) statusText = "休市中 (周末)";
        else if (totalMin < 570) statusText = "距离开盘: " + calcTimeDiff(9, 30);
        else if (totalMin >= 570 && totalMin < 690) statusText = "交易中 (早盘) | 距午休: " + calcTimeDiff(11, 30);
        else if (totalMin >= 690 && totalMin < 780) statusText = "午间休市 | 距离开盘: " + calcTimeDiff(13, 0);
        else if (totalMin >= 780 && totalMin < 900) statusText = "交易中 (午盘) | 距离收盘: " + calcTimeDiff(15, 0);
        else statusText = "已收盘";
        document.getElementById('marketCountdown').innerText = statusText;
    }

    function calcTimeDiff(tH, tM) {
        const now = new Date(); const target = new Date(); target.setHours(tH, tM, 0);
        let diff = Math.floor((target - now) / 1000); if (diff < 0) return "00:00:00";
        const h = Math.floor(diff / 3600); const m = Math.floor((diff % 3600) / 60); const s = diff % 60;
        return `${h > 0 ? h + ":" : ""}${m < 10 ? '0' + m : m}:${s < 10 ? '0' + s : s}`;
    }

    function getAIDynamicAction(d, item) {
        const current = parseFloat(d[3]);
        const cost = parseFloat(item.cost);
        const change = parseFloat(d[32]);
        const low = parseFloat(d[34]);

        if (cost > 0) {
            const profitRate = (current - cost) / cost;
            if (profitRate > 0.05) return `<span class="ai-tag ai-sell">分批止盈: ${(current*0.995).toFixed(2)}</span>`;
            if (profitRate < -0.05 && current > low) return `<span class="ai-tag ai-buy">补仓摊薄: ${(current*1.005).toFixed(2)}</span>`;
        }
        
        if (change >= 2.0) return `<span class="ai-tag ai-buy">建议买入: ${(low + (parseFloat(d[33])-low)*0.382).toFixed(2)}</span>`;
        if (change <= -2.0) return `<span class="ai-tag ai-sell">建议卖出: ${(current*0.985).toFixed(2)}</span>`;
        return '<span class="ai-tag ai-hold">持币观望</span>';
    }

    function fetchData() {
        if (stockData.length === 0) {
            document.getElementById('stockBody').innerHTML = '<tr><td colspan="6" style="text-align:center;color:#444;padding:40px">等待资产注入海克斯核心...</td></tr>';
            return;
        }
        const codes = stockData.map(s => s.code);
        const script = document.createElement('script');
        script.src = `https://qt.gtimg.cn/q=${codes.join(',')}`;
        document.body.appendChild(script);
        script.onload = function() {
            let html = '';
            let advisoryText = " [海克斯系统提示] ";
            stockData.forEach((item, index) => {
                const varName = "v_" + item.code;
                if (window[varName]) {
                    const d = window[varName].split('~');
                    const price = parseFloat(d[3]); const change = d[32]; const isUp = parseFloat(change) >= 0;
                    let pnl = '--';
                    if (item.cost > 0 && item.qty > 0) {
                        const amt = (price - item.cost) * item.qty;
                        pnl = `<span class="${amt >= 0 ? 'up' : 'down'}">${amt >= 0 ? '+' : ''}${amt.toFixed(2)}</span>`;
                    }
                    
                    html += `<tr class="stock-row" onclick="showChart('${item.code}')">
                        <td><span style="color:var(--hex-gold)">✦</span> ${d[1]}<br><small style="color:#555">${item.code.toUpperCase()}</small></td>
                        <td class="${isUp ? 'up' : 'down'} font-bold">${price.toFixed(2)}</td>
                        <td style="font-size:12px">${item.qty} / <span style="color:var(--hex-gold)">${item.cost}</span></td>
                        <td>${pnl}</td>
                        <td>${getAIDynamicAction(d, item)}</td>
                        <td style="text-align: right; padding-right: 20px;">
                            <button class="lol-btn action-btn-large btn-edit" onclick="editStock(event, ${index})">修改</button>
                            <button class="lol-btn action-btn-large btn-remove" onclick="removeStock(event, ${index})">移除</button>
                        </td>
                    </tr>`;
                    advisoryText += `✦ ${d[1]}: 当前价${price}，AI建议参考动作栏详情。 `;
                }
            });
            document.getElementById('stockBody').innerHTML = html;
            document.getElementById('aiMarqueeText').innerText = advisoryText;
            if(currentChartCode) updateOrderBook(currentChartCode);
        };
    }

    // 功能逻辑 (保持不变)
    function addStock() {
        const code = document.getElementById('stockCode').value.trim().toLowerCase();
        const cost = parseFloat(document.getElementById('buyPrice').value) || 0;
        const qty = parseFloat(document.getElementById('buyQty').value) || 0;
        if (code) {
            const index = stockData.findIndex(s => s.code === code);
            if (index > -1) stockData[index] = { code, cost, qty };
            else stockData.push({ code, cost, qty });
            saveAndRefresh();
            clearInputs();
        }
    }
    function editStock(e, index) {
        e.stopPropagation();
        const item = stockData[index];
        document.getElementById('stockCode').value = item.code;
        document.getElementById('buyPrice').value = item.cost;
        document.getElementById('buyQty').value = item.qty;
        document.getElementById('submitBtn').innerText = "确认修改";
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    function removeStock(e, index) { e.stopPropagation(); if(confirm("确定将此资产移出核心监控？")) { stockData.splice(index, 1); saveAndRefresh(); } }
    function saveAndRefresh() {
        localStorage.setItem('myHexStocks', JSON.stringify(stockData));
        document.getElementById('submitBtn').innerText = "注入资产";
        fetchData();
    }
    function clearInputs() {
        document.getElementById('stockCode').value = '';
        document.getElementById('buyPrice').value = '';
        document.getElementById('buyQty').value = '';
    }
    function updateOrderBook(code) {
        const d = window["v_" + code].split('~');
        let sellHtml = ''; for(let i=5; i>=1; i--) sellHtml += `<div class="order-row"><span style="color:#888">卖${i}</span><span class="${parseFloat(d[19+(i-1)*2])>=d[4]?'up':'down'}">${parseFloat(d[19+(i-1)*2]).toFixed(2)}</span><span style="color:var(--hex-gold)">${Math.floor(d[20+(i-1)*2]/100)}</span></div>`;
        document.getElementById('sellList').innerHTML = sellHtml;
        let buyHtml = ''; for(let i=1; i<=5; i++) buyHtml += `<div class="order-row"><span style="color:#888">买${i}</span><span class="${parseFloat(d[9+(i-1)*2])>=d[4]?'up':'down'}">${parseFloat(d[9+(i-1)*2]).toFixed(2)}</span><span style="color:var(--hex-gold)">${Math.floor(d[10+(i-1)*2]/100)}</span></div>`;
        document.getElementById('buyList').innerHTML = buyHtml;
    }
    function showChart(code) { currentChartCode = code; document.getElementById('chartArea').style.display = 'block'; changeChart('min'); updateOrderBook(code); }
    function changeChart(type) { document.getElementById('chartImg').src = `https://image.sinajs.cn/newchart/${type}/n/${currentChartCode}.gif?t=${Date.now()}`; }
    function closeChart() { currentChartCode = ""; document.getElementById('chartArea').style.display = 'none'; }
    function exportData() { const blob = new Blob([JSON.stringify(stockData)], {type:"application/json"}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download='HEXTECH_PORTFOLIO.json'; a.click(); }
    function importData(e) { const reader = new FileReader(); reader.onload = (f) => { try { stockData = JSON.parse(f.target.result); saveAndRefresh(); } catch(e) { alert("非法存档格式"); } }; reader.readAsText(e.target.files[0]); }

    setInterval(updateMarketClock, 1000);
    setInterval(fetchData, 3000);
    window.onload = () => { updateMarketClock(); fetchData(); };
</script>

</body>
</html>
